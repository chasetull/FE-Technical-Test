<div class="timeline-container">
    <!-- Controls -->
    <!-- Controls -->
    <div class="timeline-header-controls px-4 py-3 d-flex flex-column bg-white border-bottom">
        <div class="brand mb-4">
            <span style="font-weight: 900; color: #59359a; font-size: 0.9rem; letter-spacing: 1px;">NAOLOGIC</span>
        </div>

        <div class="d-flex justify-content-between align-items-end">
            <div class="column">
                <h2 class="m-0 fw-bold text-dark">Work Orders</h2>

                <div class="d-flex align-items-center">
                    <div class="bg-light rounded-pill px-2 py-1 d-flex align-items-center border">
                        <span class="text-muted small ms-2 me-2 fw-bold">Timescale</span>
                        <ng-select [items]="zoomOptions" bindLabel="label" bindValue="value" [(ngModel)]="zoomLevel"
                            (change)="onZoomChange()" [clearable]="false" class="zoom-select-pill">
                        </ng-select>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="timeline-body d-flex">
        <!-- Left Sidebar: Work Centers -->
        <div class="sidebar-centers border-end bg-light">
            <div class="sidebar-header border-bottom">Work Center</div>
            <div class="center-row border-bottom d-flex align-items-center px-3" *ngFor="let center of workCenters">
                {{ center.data.name }}
            </div>
        </div>

        <!-- Right Content: Grid -->
        <div class="timeline-scroll-area flex-grow-1 overflow-auto" #scrollContainer>
            <div class="timeline-grid" [style.width.px]="getContainerWidth()">
                <!-- Date Header -->
                <div class="date-header d-flex border-bottom">
                    <div class="date-cell border-end text-center small" *ngFor="let date of dates"
                        [style.width.px]="getColumnWidth()" [class.weekend]="isWeekend(date)"
                        [class.today-header]="isToday(date)">
                        {{ getDateLabel(date) }}
                    </div>
                </div>

                <!-- Rows -->
                <div class="grid-row border-bottom position-relative" *ngFor="let center of workCenters"
                    (click)="onGridClick($event, center)" (mousemove)="onGridMouseMove($event, center.docId)"
                    (mouseleave)="onGridMouseLeave()">
                    <!-- Grid vertical lines (background) -->
                    <div class="grid-lines d-flex h-100 position-absolute w-100" style="z-index: 0;">
                        <div class="grid-line border-end h-100" *ngFor="let date of dates"
                            [style.width.px]="getColumnWidth()" [class.weekend-bg]="isWeekend(date)"
                            [class.today-line]="isToday(date)">
                        </div>
                    </div>

                    <!-- Phantom Bar (Hover) -->
                    <div class="phantom-layer position-absolute w-100 h-100" style="z-index: 0; pointer-events: none;"
                        *ngIf="hoveredCenterId === center.docId">
                        <div class="phantom-bar position-absolute rounded" [style.left]="hoveredLeft"
                            [style.width.px]="getColumnWidth()"
                            style="height: 40px; top: 10px; background-color: rgba(102, 16, 242, 0.1); border: 1px dashed #6610f2;">
                            <div class="tooltip-text small text-dark bg-white border rounded px-2 py-1 shadow-sm position-absolute"
                                style="top: -30px; left: 0; white-space: nowrap;">
                                Click to add
                            </div>
                        </div>
                    </div>

                    <!-- Work Order Bars -->
                    <div class="orders-layer position-absolute w-100 h-100" style="z-index: 1;">
                        <div class="work-order-bar position-absolute small overflow-hidden shadow-sm"
                            *ngFor="let order of getWorkOrdersForCenter(center.docId)" [ngStyle]="getBarPosition(order)"
                            [class.status-open]="order.data.status === 'open'"
                            [class.status-in-progress]="order.data.status === 'in-progress'"
                            [class.status-complete]="order.data.status === 'complete'"
                            [class.status-blocked]="order.data.status === 'blocked'"
                            (click)="onOrderClick($event, order)">

                            <span class="text-truncate fw-bold">{{ order.data.name }}</span>
                            <span class="status-pill ms-2">{{ order.data.status }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <app-create-edit-panel [isOpen]="panelOpen" [mode]="panelMode" [workOrder]="selectedOrder"
        [workCenters]="workCenters" [initialDate]="clickedDate" (close)="onPanelClose()" (save)="onPanelSave($event)"
        (delete)="onPanelDelete($event)">
    </app-create-edit-panel>
</div>